BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%thistle%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 | 266633400.830792
 ALGERIA                   |   1997 | 463648799.169586
 ALGERIA                   |   1996 | 455886908.542132
 ALGERIA                   |   1995 | 457111232.759058
 ALGERIA                   |   1994 | 454149846.728194
 ALGERIA                   |   1993 |  452545237.43827
 ALGERIA                   |   1992 | 456537094.161673
 ARGENTINA                 |   1998 |  274040004.65479
 ARGENTINA                 |   1997 | 474821122.414523
 ARGENTINA                 |   1996 | 466397926.930551
 ARGENTINA                 |   1995 | 465762615.012904
 ARGENTINA                 |   1994 | 469268231.995875
 ARGENTINA                 |   1993 | 474287501.105579
 ARGENTINA                 |   1992 | 468114733.530933
 BRAZIL                    |   1998 | 269611743.163352
 BRAZIL                    |   1997 | 461972078.259122
 BRAZIL                    |   1996 | 458491939.310232
 BRAZIL                    |   1995 | 457588292.012687
 BRAZIL                    |   1994 | 457374585.169667
 BRAZIL                    |   1993 | 459830211.773488
 BRAZIL                    |   1992 | 466377151.210417
 CANADA                    |   1998 | 275610762.088914
 CANADA                    |   1997 | 476324666.449454
 CANADA                    |   1996 | 478238646.787301
 CANADA                    |   1995 | 473033176.748517
 CANADA                    |   1994 | 483921535.397701
 CANADA                    |   1993 | 480188588.545141
 CANADA                    |   1992 | 480949279.206652
 CHINA                     |   1998 | 270625610.182873
 CHINA                     |   1997 | 457256466.475869
 CHINA                     |   1996 | 458917076.611702
 CHINA                     |   1995 | 455954971.638503
 CHINA                     |   1994 | 459954120.572741
 CHINA                     |   1993 | 462627676.449356
 CHINA                     |   1992 | 463905516.314041
 EGYPT                     |   1998 | 268393150.002159
 EGYPT                     |   1997 | 463888548.001591
 EGYPT                     |   1996 | 458878535.347564
 EGYPT                     |   1995 | 467239236.773216
 EGYPT                     |   1994 | 458214933.260601
 EGYPT                     |   1993 | 460301128.339427
 EGYPT                     |   1992 | 463486106.719082
 ETHIOPIA                  |   1998 | 266041844.386951
 ETHIOPIA                  |   1997 | 458930140.215291
 ETHIOPIA                  |   1996 | 455165243.276325
 ETHIOPIA                  |   1995 | 458318932.288091
 ETHIOPIA                  |   1994 | 459926380.894702
 ETHIOPIA                  |   1993 | 452832306.158141
 ETHIOPIA                  |   1992 | 456398132.273921
 FRANCE                    |   1998 | 271689455.049863
 FRANCE                    |   1997 | 456718905.157677
 FRANCE                    |   1996 | 460699692.685568
 FRANCE                    |   1995 | 455179644.559232
 FRANCE                    |   1994 | 452510644.982937
 FRANCE                    |   1993 |  458966660.37913
 FRANCE                    |   1992 | 462138031.633241
 GERMANY                   |   1998 | 270533140.412928
 GERMANY                   |   1997 | 464769509.667165
 GERMANY                   |   1996 | 464150714.674662
 GERMANY                   |   1995 | 464971800.936471
 GERMANY                   |   1994 |  467680066.82885
 GERMANY                   |   1993 | 470539081.205859
 GERMANY                   |   1992 | 466258483.420665
 INDIA                     |   1998 | 274346998.822297
 INDIA                     |   1997 | 474495053.612376
 INDIA                     |   1996 | 474059464.722876
 INDIA                     |   1995 | 477035848.848326
 INDIA                     |   1994 | 475006170.225888
 INDIA                     |   1993 | 474814898.183151
 INDIA                     |   1992 | 469020314.486048
 INDONESIA                 |   1998 | 271501456.871245
 INDONESIA                 |   1997 | 450494573.975052
 INDONESIA                 |   1996 | 454379272.372555
 INDONESIA                 |   1995 | 454852722.470655
 INDONESIA                 |   1994 | 455497866.600996
 INDONESIA                 |   1993 | 460673463.269891
 INDONESIA                 |   1992 | 456437753.879458
 IRAN                      |   1998 | 264882104.342193
 IRAN                      |   1997 | 469708373.246218
 IRAN                      |   1996 | 460469776.921674
 IRAN                      |   1995 | 461511241.413513
 IRAN                      |   1994 | 458625902.952052
 IRAN                      |   1993 | 459308057.026436
 IRAN                      |   1992 | 464432220.758948
 IRAQ                      |   1998 | 272096915.246576
 IRAQ                      |   1997 | 466288240.321071
 IRAQ                      |   1996 | 470450293.768199
 IRAQ                      |   1995 | 463762378.827741
 IRAQ                      |   1994 | 466589004.813061
 IRAQ                      |   1993 | 461827266.203995
 IRAQ                      |   1992 | 464339254.492884
 JAPAN                     |   1998 | 269221554.270336
 JAPAN                     |   1997 | 450386392.087833
 JAPAN                     |   1996 | 454638536.877191
 JAPAN                     |   1995 | 454354690.207389
 JAPAN                     |   1994 | 451615522.355183
 JAPAN                     |   1993 | 463499323.813166
 JAPAN                     |   1992 | 451116711.742153
 JORDAN                    |   1998 | 267831595.641568
 JORDAN                    |   1997 |  456731425.21846
 JORDAN                    |   1996 | 458082627.068273
 JORDAN                    |   1995 | 447074599.688379
 JORDAN                    |   1994 | 455156979.007501
 JORDAN                    |   1993 | 452329377.356733
 JORDAN                    |   1992 | 457344142.820431
 KENYA                     |   1998 | 270550068.398211
 KENYA                     |   1997 |  465131153.02038
 KENYA                     |   1996 |  472397671.12602
 KENYA                     |   1995 | 466603943.070386
 KENYA                     |   1994 | 465509089.695171
 KENYA                     |   1993 | 475415721.456261
 KENYA                     |   1992 | 471703700.494865
 MOROCCO                   |   1998 | 267079972.658953
 MOROCCO                   |   1997 |  462352561.45255
 MOROCCO                   |   1996 | 462280605.492228
 MOROCCO                   |   1995 | 458246130.614162
 MOROCCO                   |   1994 | 458399934.276606
 MOROCCO                   |   1993 | 464428907.865588
 MOROCCO                   |   1992 | 465922790.774567
 MOZAMBIQUE                |   1998 | 268893076.122497
 MOZAMBIQUE                |   1997 | 449811685.012193
 MOZAMBIQUE                |   1996 | 455038704.712539
 MOZAMBIQUE                |   1995 | 451595865.967461
 MOZAMBIQUE                |   1994 | 457029356.852843
 MOZAMBIQUE                |   1993 | 455188317.746789
 MOZAMBIQUE                |   1992 | 448733433.755485
 PERU                      |   1998 | 269907709.702521
 PERU                      |   1997 | 464337849.455042
 PERU                      |   1996 | 466616074.246213
 PERU                      |   1995 | 455737784.316115
 PERU                      |   1994 | 466890997.874802
 PERU                      |   1993 | 464563089.778092
 PERU                      |   1992 | 459739522.749806
 ROMANIA                   |   1998 | 268337494.979821
 ROMANIA                   |   1997 | 457901514.547002
 ROMANIA                   |   1996 | 460498146.462842
 ROMANIA                   |   1995 | 456403072.728796
 ROMANIA                   |   1994 | 463794198.651384
 ROMANIA                   |   1993 | 459808751.489492
 ROMANIA                   |   1992 | 464421624.123939
 RUSSIA                    |   1998 |  280470654.77555
 RUSSIA                    |   1997 | 467003839.533537
 RUSSIA                    |   1996 |  465436315.17371
 RUSSIA                    |   1995 |  472058677.77173
 RUSSIA                    |   1994 | 470926796.833015
 RUSSIA                    |   1993 | 475834238.832225
 RUSSIA                    |   1992 | 466914133.121346
 SAUDI ARABIA              |   1998 | 270205918.589211
 SAUDI ARABIA              |   1997 | 457319453.057616
 SAUDI ARABIA              |   1996 | 465371968.184939
 SAUDI ARABIA              |   1995 | 467503895.772056
 SAUDI ARABIA              |   1994 | 463619082.766719
 SAUDI ARABIA              |   1993 | 463428088.860987
 SAUDI ARABIA              |   1992 | 466860187.329791
 UNITED KINGDOM            |   1998 | 266286908.833145
 UNITED KINGDOM            |   1997 | 459222403.696245
 UNITED KINGDOM            |   1996 | 457943415.480875
 UNITED KINGDOM            |   1995 | 461655568.829805
 UNITED KINGDOM            |   1994 | 462611913.352458
 UNITED KINGDOM            |   1993 | 467926376.535712
 UNITED KINGDOM            |   1992 | 457022554.427443
 UNITED STATES             |   1998 | 273457918.339634
 UNITED STATES             |   1997 | 468037282.140432
 UNITED STATES             |   1996 | 477371971.529122
 UNITED STATES             |   1995 | 465729250.805382
 UNITED STATES             |   1994 | 474409916.461886
 UNITED STATES             |   1993 | 468424281.379259
 UNITED STATES             |   1992 | 472466406.218895
 VIETNAM                   |   1998 | 271553812.520858
 VIETNAM                   |   1997 | 465277966.171901
 VIETNAM                   |   1996 | 459984200.839773
 VIETNAM                   |   1995 | 460616243.034499
 VIETNAM                   |   1994 | 465517720.985374
 VIETNAM                   |   1993 | 466162763.573126
 VIETNAM                   |   1992 | 462254491.681746
(175 rows)

COMMIT;
COMMIT
