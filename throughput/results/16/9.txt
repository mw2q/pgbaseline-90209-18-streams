BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%slate%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 | 260665741.312609
 ALGERIA                   |   1997 | 449492935.030653
 ALGERIA                   |   1996 | 451162522.052719
 ALGERIA                   |   1995 | 445096854.976091
 ALGERIA                   |   1994 | 455587508.836794
 ALGERIA                   |   1993 | 443623505.164085
 ALGERIA                   |   1992 | 451272892.543534
 ARGENTINA                 |   1998 | 278420751.447612
 ARGENTINA                 |   1997 | 470444620.295005
 ARGENTINA                 |   1996 | 465183248.062635
 ARGENTINA                 |   1995 | 468183576.434274
 ARGENTINA                 |   1994 |  472364429.75589
 ARGENTINA                 |   1993 | 462706990.247212
 ARGENTINA                 |   1992 |  467451643.19332
 BRAZIL                    |   1998 | 276072675.949452
 BRAZIL                    |   1997 | 473535310.823536
 BRAZIL                    |   1996 | 472369972.523856
 BRAZIL                    |   1995 | 469098392.858373
 BRAZIL                    |   1994 | 466326086.574637
 BRAZIL                    |   1993 | 471674503.520512
 BRAZIL                    |   1992 | 476861750.898343
 CANADA                    |   1998 | 272233752.274982
 CANADA                    |   1997 | 469035491.765081
 CANADA                    |   1996 | 468691972.300142
 CANADA                    |   1995 | 473776661.781452
 CANADA                    |   1994 | 480965139.981172
 CANADA                    |   1993 | 477564649.171715
 CANADA                    |   1992 | 470851845.608846
 CHINA                     |   1998 |  275190841.56762
 CHINA                     |   1997 | 464664858.708288
 CHINA                     |   1996 | 473338500.476466
 CHINA                     |   1995 | 464486433.438315
 CHINA                     |   1994 | 465657137.530767
 CHINA                     |   1993 | 470017657.404061
 CHINA                     |   1992 | 467884007.050273
 EGYPT                     |   1998 | 268939583.574548
 EGYPT                     |   1997 | 473075648.004888
 EGYPT                     |   1996 | 466834908.032973
 EGYPT                     |   1995 | 467258219.388545
 EGYPT                     |   1994 | 471163643.688741
 EGYPT                     |   1993 | 468537400.716108
 EGYPT                     |   1992 |  477277417.75573
 ETHIOPIA                  |   1998 | 274620161.797807
 ETHIOPIA                  |   1997 | 455627810.900672
 ETHIOPIA                  |   1996 | 451732614.710965
 ETHIOPIA                  |   1995 | 456311790.966262
 ETHIOPIA                  |   1994 | 461838483.801288
 ETHIOPIA                  |   1993 | 458983812.008043
 ETHIOPIA                  |   1992 | 459260756.679024
 FRANCE                    |   1998 | 268930833.378414
 FRANCE                    |   1997 | 460119560.834094
 FRANCE                    |   1996 | 457765282.365119
 FRANCE                    |   1995 | 462156274.535853
 FRANCE                    |   1994 | 458666492.819006
 FRANCE                    |   1993 | 461669487.668431
 FRANCE                    |   1992 | 453192541.743387
 GERMANY                   |   1998 | 281593500.719795
 GERMANY                   |   1997 | 473340129.652689
 GERMANY                   |   1996 | 477852817.892996
 GERMANY                   |   1995 | 480622574.049714
 GERMANY                   |   1994 |  475187713.04723
 GERMANY                   |   1993 | 471038334.669025
 GERMANY                   |   1992 | 471574931.606201
 INDIA                     |   1998 | 267030323.337194
 INDIA                     |   1997 | 463045479.249754
 INDIA                     |   1996 | 479053607.701335
 INDIA                     |   1995 | 477721235.386617
 INDIA                     |   1994 | 465651750.936347
 INDIA                     |   1993 | 469120534.042367
 INDIA                     |   1992 | 466192760.381758
 INDONESIA                 |   1998 | 268208949.159396
 INDONESIA                 |   1997 | 462728012.254361
 INDONESIA                 |   1996 | 473457266.718197
 INDONESIA                 |   1995 | 458368546.561195
 INDONESIA                 |   1994 | 463702567.384234
 INDONESIA                 |   1993 | 462164450.048675
 INDONESIA                 |   1992 |  460435727.96216
 IRAN                      |   1998 | 267313807.639793
 IRAN                      |   1997 | 464725689.948247
 IRAN                      |   1996 | 462244424.450488
 IRAN                      |   1995 | 461856614.626709
 IRAN                      |   1994 | 465644268.536468
 IRAN                      |   1993 | 457850228.943975
 IRAN                      |   1992 | 466896188.670967
 IRAQ                      |   1998 | 280316365.449728
 IRAQ                      |   1997 | 471725777.987584
 IRAQ                      |   1996 | 479019707.057936
 IRAQ                      |   1995 | 470418872.604134
 IRAQ                      |   1994 | 472328905.835851
 IRAQ                      |   1993 | 469231764.024532
 IRAQ                      |   1992 | 476732554.189776
 JAPAN                     |   1998 | 267853761.736497
 JAPAN                     |   1997 | 463944921.629885
 JAPAN                     |   1996 |  469931582.69732
 JAPAN                     |   1995 | 460939356.086447
 JAPAN                     |   1994 | 466826894.073195
 JAPAN                     |   1993 | 463825064.318361
 JAPAN                     |   1992 | 462841381.342266
 JORDAN                    |   1998 | 268716999.297794
 JORDAN                    |   1997 | 450030118.361046
 JORDAN                    |   1996 | 459039208.865429
 JORDAN                    |   1995 | 454735347.869635
 JORDAN                    |   1994 | 456340538.970623
 JORDAN                    |   1993 | 448609573.070907
 JORDAN                    |   1992 | 452817449.871549
 KENYA                     |   1998 | 282377440.890612
 KENYA                     |   1997 | 470039431.545232
 KENYA                     |   1996 | 478679395.352794
 KENYA                     |   1995 |  474517729.78554
 KENYA                     |   1994 | 471564459.869244
 KENYA                     |   1993 | 479485884.760389
 KENYA                     |   1992 | 469923654.784653
 MOROCCO                   |   1998 | 274485232.617076
 MOROCCO                   |   1997 | 459937417.594725
 MOROCCO                   |   1996 | 464888970.330182
 MOROCCO                   |   1995 | 468804973.218488
 MOROCCO                   |   1994 | 463635353.123608
 MOROCCO                   |   1993 | 465999972.622432
 MOROCCO                   |   1992 | 472122815.911504
 MOZAMBIQUE                |   1998 | 266943785.445629
 MOZAMBIQUE                |   1997 | 454901614.628234
 MOZAMBIQUE                |   1996 | 457167498.319174
 MOZAMBIQUE                |   1995 | 455055153.333327
 MOZAMBIQUE                |   1994 | 449924183.270875
 MOZAMBIQUE                |   1993 | 448402924.407688
 MOZAMBIQUE                |   1992 | 455319887.756594
 PERU                      |   1998 | 279213419.233072
 PERU                      |   1997 | 468871770.510927
 PERU                      |   1996 | 467438987.781645
 PERU                      |   1995 | 474798098.242151
 PERU                      |   1994 | 467128571.786274
 PERU                      |   1993 | 471627355.098961
 PERU                      |   1992 |  461037287.67147
 ROMANIA                   |   1998 | 275603128.856108
 ROMANIA                   |   1997 | 460361703.922793
 ROMANIA                   |   1996 | 465402434.761018
 ROMANIA                   |   1995 | 455267721.743269
 ROMANIA                   |   1994 | 459855603.828021
 ROMANIA                   |   1993 |  463663229.51506
 ROMANIA                   |   1992 | 466248742.724274
 RUSSIA                    |   1998 |  275071675.93013
 RUSSIA                    |   1997 | 465426023.034481
 RUSSIA                    |   1996 | 471283600.492822
 RUSSIA                    |   1995 | 463879392.673191
 RUSSIA                    |   1994 | 463442282.380403
 RUSSIA                    |   1993 | 463154591.225809
 RUSSIA                    |   1992 | 466262233.589261
 SAUDI ARABIA              |   1998 | 277355046.994997
 SAUDI ARABIA              |   1997 |  469961104.32814
 SAUDI ARABIA              |   1996 | 464892198.568891
 SAUDI ARABIA              |   1995 | 466339934.851624
 SAUDI ARABIA              |   1994 | 462768447.624887
 SAUDI ARABIA              |   1993 | 467082914.436638
 SAUDI ARABIA              |   1992 |  460861060.69257
 UNITED KINGDOM            |   1998 |  275067541.25545
 UNITED KINGDOM            |   1997 | 470127093.228289
 UNITED KINGDOM            |   1996 | 466796839.770357
 UNITED KINGDOM            |   1995 | 471611203.120642
 UNITED KINGDOM            |   1994 | 473098660.541488
 UNITED KINGDOM            |   1993 | 464029688.901394
 UNITED KINGDOM            |   1992 |  465900754.19675
 UNITED STATES             |   1998 | 274504603.974074
 UNITED STATES             |   1997 | 465155942.370117
 UNITED STATES             |   1996 | 462254801.999964
 UNITED STATES             |   1995 | 469181686.012297
 UNITED STATES             |   1994 | 468667294.110422
 UNITED STATES             |   1993 | 466921067.857228
 UNITED STATES             |   1992 | 465643908.106617
 VIETNAM                   |   1998 | 270894791.606063
 VIETNAM                   |   1997 | 474319182.918711
 VIETNAM                   |   1996 | 466785454.344651
 VIETNAM                   |   1995 |  456234392.06875
 VIETNAM                   |   1994 | 469420330.673765
 VIETNAM                   |   1993 | 472670992.046317
 VIETNAM                   |   1992 | 458025422.283527
(175 rows)

COMMIT;
COMMIT
