BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%misty%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 | 271967454.639086
 ALGERIA                   |   1997 | 455282783.696068
 ALGERIA                   |   1996 | 464072657.833873
 ALGERIA                   |   1995 |  469997737.21903
 ALGERIA                   |   1994 | 460236153.961584
 ALGERIA                   |   1993 | 456272744.146408
 ALGERIA                   |   1992 | 457848121.533243
 ARGENTINA                 |   1998 | 280351174.267026
 ARGENTINA                 |   1997 | 462755214.327891
 ARGENTINA                 |   1996 | 469635611.497627
 ARGENTINA                 |   1995 | 469425164.325819
 ARGENTINA                 |   1994 | 467664220.424991
 ARGENTINA                 |   1993 | 464469161.856342
 ARGENTINA                 |   1992 |  470949782.77196
 BRAZIL                    |   1998 | 267951726.027544
 BRAZIL                    |   1997 | 465601735.101305
 BRAZIL                    |   1996 | 457631016.317784
 BRAZIL                    |   1995 | 464438306.539851
 BRAZIL                    |   1994 | 450847403.252854
 BRAZIL                    |   1993 | 457979455.246926
 BRAZIL                    |   1992 | 464556592.658469
 CANADA                    |   1998 | 276550509.672931
 CANADA                    |   1997 | 473716695.303581
 CANADA                    |   1996 | 467689665.440881
 CANADA                    |   1995 | 471091071.985308
 CANADA                    |   1994 | 478318500.744488
 CANADA                    |   1993 | 477467140.606115
 CANADA                    |   1992 | 479094963.106281
 CHINA                     |   1998 | 271973961.901251
 CHINA                     |   1997 | 459952369.631369
 CHINA                     |   1996 | 473268661.560896
 CHINA                     |   1995 | 469183504.487636
 CHINA                     |   1994 | 465597167.831864
 CHINA                     |   1993 | 470638549.406664
 CHINA                     |   1992 | 460870907.566964
 EGYPT                     |   1998 | 267727674.227605
 EGYPT                     |   1997 | 462088943.688124
 EGYPT                     |   1996 | 467915765.068106
 EGYPT                     |   1995 | 456998855.218775
 EGYPT                     |   1994 | 448655244.389014
 EGYPT                     |   1993 | 463212746.947611
 EGYPT                     |   1992 | 459280602.633338
 ETHIOPIA                  |   1998 | 273826303.951204
 ETHIOPIA                  |   1997 | 455139974.281845
 ETHIOPIA                  |   1996 | 456157593.622111
 ETHIOPIA                  |   1995 | 450747169.057753
 ETHIOPIA                  |   1994 | 452063163.183692
 ETHIOPIA                  |   1993 | 461835524.879464
 ETHIOPIA                  |   1992 |  459263726.71731
 FRANCE                    |   1998 | 270421288.369488
 FRANCE                    |   1997 | 465436733.662683
 FRANCE                    |   1996 | 467033669.628685
 FRANCE                    |   1995 | 463483908.762029
 FRANCE                    |   1994 | 469898205.168485
 FRANCE                    |   1993 | 464986660.604914
 FRANCE                    |   1992 | 461539745.213498
 GERMANY                   |   1998 | 277955868.001796
 GERMANY                   |   1997 | 474304037.251573
 GERMANY                   |   1996 | 467898212.479245
 GERMANY                   |   1995 |  480676480.66581
 GERMANY                   |   1994 | 473197712.906647
 GERMANY                   |   1993 | 472082033.252419
 GERMANY                   |   1992 | 467573121.551863
 INDIA                     |   1998 | 273240886.098145
 INDIA                     |   1997 | 473575616.182087
 INDIA                     |   1996 | 478523468.403099
 INDIA                     |   1995 | 473238767.403916
 INDIA                     |   1994 | 477053509.809635
 INDIA                     |   1993 | 471161359.918606
 INDIA                     |   1992 | 471339874.919199
 INDONESIA                 |   1998 | 274553607.482676
 INDONESIA                 |   1997 | 461939044.516468
 INDONESIA                 |   1996 | 465653135.344033
 INDONESIA                 |   1995 | 464727066.672378
 INDONESIA                 |   1994 |  459040350.06023
 INDONESIA                 |   1993 |  458186342.98397
 INDONESIA                 |   1992 |  456146844.39918
 IRAN                      |   1998 | 271238891.285911
 IRAN                      |   1997 | 460161988.935448
 IRAN                      |   1996 | 460627614.458845
 IRAN                      |   1995 | 464381146.366055
 IRAN                      |   1994 | 452612089.042339
 IRAN                      |   1993 | 462889402.701207
 IRAN                      |   1992 | 466633914.680172
 IRAQ                      |   1998 | 279761501.528056
 IRAQ                      |   1997 | 465812742.547654
 IRAQ                      |   1996 | 476348141.648303
 IRAQ                      |   1995 | 472934410.734851
 IRAQ                      |   1994 | 477766292.380314
 IRAQ                      |   1993 | 467481433.090295
 IRAQ                      |   1992 | 474375090.040683
 JAPAN                     |   1998 | 262187089.313021
 JAPAN                     |   1997 | 464515747.394397
 JAPAN                     |   1996 | 462296223.186421
 JAPAN                     |   1995 | 458904917.074256
 JAPAN                     |   1994 | 454836207.641147
 JAPAN                     |   1993 | 460613229.446875
 JAPAN                     |   1992 | 460306034.128115
 JORDAN                    |   1998 | 270795703.448319
 JORDAN                    |   1997 |  462003064.54272
 JORDAN                    |   1996 | 461119150.258863
 JORDAN                    |   1995 | 462211101.862353
 JORDAN                    |   1994 | 460022666.951972
 JORDAN                    |   1993 | 472857706.902701
 JORDAN                    |   1992 | 460238340.742817
 KENYA                     |   1998 | 280921585.753845
 KENYA                     |   1997 | 463802778.400391
 KENYA                     |   1996 | 473283580.801212
 KENYA                     |   1995 | 473723489.996868
 KENYA                     |   1994 | 478356664.540565
 KENYA                     |   1993 | 472738420.063211
 KENYA                     |   1992 | 477230441.545007
 MOROCCO                   |   1998 | 272712044.272479
 MOROCCO                   |   1997 | 471103618.530595
 MOROCCO                   |   1996 | 477950346.937613
 MOROCCO                   |   1995 | 471664045.585575
 MOROCCO                   |   1994 | 470176517.086825
 MOROCCO                   |   1993 | 467917419.416738
 MOROCCO                   |   1992 | 469669322.425568
 MOZAMBIQUE                |   1998 | 275371993.191065
 MOZAMBIQUE                |   1997 | 466291211.735154
 MOZAMBIQUE                |   1996 | 473686086.303692
 MOZAMBIQUE                |   1995 | 467894874.158023
 MOZAMBIQUE                |   1994 | 465674856.852653
 MOZAMBIQUE                |   1993 |  466145237.98997
 MOZAMBIQUE                |   1992 | 458643019.671998
 PERU                      |   1998 |  265832864.84902
 PERU                      |   1997 | 456802750.838145
 PERU                      |   1996 | 467760732.609567
 PERU                      |   1995 | 464407191.387424
 PERU                      |   1994 | 458838895.980965
 PERU                      |   1993 | 453885416.258591
 PERU                      |   1992 | 464695705.848286
 ROMANIA                   |   1998 | 278537088.108768
 ROMANIA                   |   1997 | 478940808.039603
 ROMANIA                   |   1996 | 477544962.184521
 ROMANIA                   |   1995 | 467739288.241659
 ROMANIA                   |   1994 | 473392165.361562
 ROMANIA                   |   1993 | 470139897.538932
 ROMANIA                   |   1992 | 470903792.041582
 RUSSIA                    |   1998 | 272302841.807329
 RUSSIA                    |   1997 |  465147419.07913
 RUSSIA                    |   1996 |  464244986.17661
 RUSSIA                    |   1995 | 469493418.869607
 RUSSIA                    |   1994 | 463050004.428372
 RUSSIA                    |   1993 | 465095421.518709
 RUSSIA                    |   1992 | 465112763.988683
 SAUDI ARABIA              |   1998 | 278162192.427119
 SAUDI ARABIA              |   1997 | 467481731.435898
 SAUDI ARABIA              |   1996 | 466717587.996741
 SAUDI ARABIA              |   1995 | 474911847.490674
 SAUDI ARABIA              |   1994 | 467950173.087814
 SAUDI ARABIA              |   1993 | 470306425.778907
 SAUDI ARABIA              |   1992 | 473832752.164178
 UNITED KINGDOM            |   1998 | 269232729.623548
 UNITED KINGDOM            |   1997 | 456727874.878715
 UNITED KINGDOM            |   1996 |  449628538.47452
 UNITED KINGDOM            |   1995 | 458229569.180753
 UNITED KINGDOM            |   1994 | 459681231.685251
 UNITED KINGDOM            |   1993 | 459039756.254506
 UNITED KINGDOM            |   1992 | 446991530.197568
 UNITED STATES             |   1998 | 274942144.977663
 UNITED STATES             |   1997 | 484267311.727035
 UNITED STATES             |   1996 | 482004595.520239
 UNITED STATES             |   1995 | 473486136.925951
 UNITED STATES             |   1994 | 476452667.642259
 UNITED STATES             |   1993 | 474977765.457806
 UNITED STATES             |   1992 | 477743752.761911
 VIETNAM                   |   1998 |  273844993.55685
 VIETNAM                   |   1997 | 466479068.212158
 VIETNAM                   |   1996 | 476766495.969259
 VIETNAM                   |   1995 | 457866903.967405
 VIETNAM                   |   1994 | 464519069.196947
 VIETNAM                   |   1993 | 465084664.564132
 VIETNAM                   |   1992 | 473103557.657965
(175 rows)

COMMIT;
COMMIT
