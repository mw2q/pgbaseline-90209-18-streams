BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%steel%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 |   268679987.0905
 ALGERIA                   |   1997 | 460159782.263051
 ALGERIA                   |   1996 | 466204910.175434
 ALGERIA                   |   1995 |  469056962.93625
 ALGERIA                   |   1994 | 461008923.709745
 ALGERIA                   |   1993 | 467710671.739331
 ALGERIA                   |   1992 | 467002314.199156
 ARGENTINA                 |   1998 |  275257499.49319
 ARGENTINA                 |   1997 | 471022823.896038
 ARGENTINA                 |   1996 | 471470605.206571
 ARGENTINA                 |   1995 | 467368106.786413
 ARGENTINA                 |   1994 | 472093724.642594
 ARGENTINA                 |   1993 |  470660068.25154
 ARGENTINA                 |   1992 | 467165870.568597
 BRAZIL                    |   1998 | 272997762.147395
 BRAZIL                    |   1997 | 462192004.295427
 BRAZIL                    |   1996 | 459702189.758625
 BRAZIL                    |   1995 | 462323670.280108
 BRAZIL                    |   1994 | 464667354.367737
 BRAZIL                    |   1993 | 468425661.444423
 BRAZIL                    |   1992 | 463776144.957344
 CANADA                    |   1998 | 276944729.170686
 CANADA                    |   1997 |  483390806.08817
 CANADA                    |   1996 | 481356830.714611
 CANADA                    |   1995 | 477022280.157275
 CANADA                    |   1994 | 485125460.284185
 CANADA                    |   1993 | 475380876.614184
 CANADA                    |   1992 | 476831692.968123
 CHINA                     |   1998 | 273911568.403627
 CHINA                     |   1997 | 469299839.848642
 CHINA                     |   1996 | 467906034.422035
 CHINA                     |   1995 | 462176963.664336
 CHINA                     |   1994 |  466713664.86653
 CHINA                     |   1993 | 468965106.352268
 CHINA                     |   1992 | 465732249.923093
 EGYPT                     |   1998 | 276606042.774102
 EGYPT                     |   1997 | 466073711.991003
 EGYPT                     |   1996 | 468215011.256826
 EGYPT                     |   1995 | 466061822.346712
 EGYPT                     |   1994 | 463393134.597081
 EGYPT                     |   1993 | 472951746.376369
 EGYPT                     |   1992 | 463533033.020204
 ETHIOPIA                  |   1998 | 271674877.008782
 ETHIOPIA                  |   1997 | 462749413.872746
 ETHIOPIA                  |   1996 | 452828397.543644
 ETHIOPIA                  |   1995 | 457614489.499575
 ETHIOPIA                  |   1994 | 467138719.137379
 ETHIOPIA                  |   1993 |  451813036.17774
 ETHIOPIA                  |   1992 | 470174341.274654
 FRANCE                    |   1998 | 270381752.239404
 FRANCE                    |   1997 |  463921535.90004
 FRANCE                    |   1996 | 467112897.732728
 FRANCE                    |   1995 |  464856578.07703
 FRANCE                    |   1994 | 465355559.149385
 FRANCE                    |   1993 | 469839778.534394
 FRANCE                    |   1992 | 471132504.903493
 GERMANY                   |   1998 | 272790972.358692
 GERMANY                   |   1997 | 465373861.617895
 GERMANY                   |   1996 | 471828278.266071
 GERMANY                   |   1995 | 470024218.444178
 GERMANY                   |   1994 |  467387831.10766
 GERMANY                   |   1993 | 468836986.266512
 GERMANY                   |   1992 | 468758215.917334
 INDIA                     |   1998 | 277313761.770005
 INDIA                     |   1997 | 469750895.584312
 INDIA                     |   1996 | 474247337.783639
 INDIA                     |   1995 | 463658195.602868
 INDIA                     |   1994 | 470856178.986809
 INDIA                     |   1993 | 468164204.024938
 INDIA                     |   1992 | 465776827.786484
 INDONESIA                 |   1998 | 278278269.723665
 INDONESIA                 |   1997 | 468255770.580447
 INDONESIA                 |   1996 | 467302311.879021
 INDONESIA                 |   1995 | 468176559.187299
 INDONESIA                 |   1994 | 464207270.424011
 INDONESIA                 |   1993 | 472432614.716752
 INDONESIA                 |   1992 | 460772757.794325
 IRAN                      |   1998 | 267956718.768937
 IRAN                      |   1997 |  464595477.86829
 IRAN                      |   1996 | 456838321.429806
 IRAN                      |   1995 | 458402710.702487
 IRAN                      |   1994 | 459179892.917968
 IRAN                      |   1993 | 455906989.085801
 IRAN                      |   1992 |  463250585.73098
 IRAQ                      |   1998 | 275671250.040395
 IRAQ                      |   1997 | 472351016.887269
 IRAQ                      |   1996 | 478963876.750846
 IRAQ                      |   1995 | 470646575.442476
 IRAQ                      |   1994 | 469087505.898731
 IRAQ                      |   1993 | 483036559.967957
 IRAQ                      |   1992 | 478124583.351895
 JAPAN                     |   1998 | 269660087.696589
 JAPAN                     |   1997 | 466160559.088212
 JAPAN                     |   1996 | 469586439.438565
 JAPAN                     |   1995 | 468387203.839215
 JAPAN                     |   1994 |   468946822.1934
 JAPAN                     |   1993 | 476517397.190311
 JAPAN                     |   1992 | 473140630.857093
 JORDAN                    |   1998 | 269826783.127594
 JORDAN                    |   1997 | 455222502.760655
 JORDAN                    |   1996 | 457095149.818489
 JORDAN                    |   1995 | 460237960.509595
 JORDAN                    |   1994 | 458176601.604965
 JORDAN                    |   1993 | 456370372.942848
 JORDAN                    |   1992 | 455652391.935554
 KENYA                     |   1998 | 280245455.337181
 KENYA                     |   1997 | 481236178.608579
 KENYA                     |   1996 | 481474497.156466
 KENYA                     |   1995 |  471224109.84352
 KENYA                     |   1994 | 468515895.357707
 KENYA                     |   1993 | 472423695.515499
 KENYA                     |   1992 | 470479038.386531
 MOROCCO                   |   1998 |  275283906.64124
 MOROCCO                   |   1997 | 475492527.237009
 MOROCCO                   |   1996 | 469811466.552088
 MOROCCO                   |   1995 | 472144917.210698
 MOROCCO                   |   1994 | 472811646.075873
 MOROCCO                   |   1993 | 473869705.062757
 MOROCCO                   |   1992 |  475914703.46139
 MOZAMBIQUE                |   1998 | 277172901.875682
 MOZAMBIQUE                |   1997 | 460868179.172233
 MOZAMBIQUE                |   1996 | 463203858.399887
 MOZAMBIQUE                |   1995 | 465936546.989201
 MOZAMBIQUE                |   1994 | 466003275.755162
 MOZAMBIQUE                |   1993 | 466328833.045167
 MOZAMBIQUE                |   1992 | 458211658.295176
 PERU                      |   1998 | 274787843.399898
 PERU                      |   1997 | 467918097.789913
 PERU                      |   1996 | 467160642.143806
 PERU                      |   1995 | 463029984.571567
 PERU                      |   1994 | 466191424.028921
 PERU                      |   1993 | 465687000.477561
 PERU                      |   1992 | 471564043.808738
 ROMANIA                   |   1998 | 276150740.396857
 ROMANIA                   |   1997 | 477171500.301121
 ROMANIA                   |   1996 | 470881305.436376
 ROMANIA                   |   1995 | 471530076.947542
 ROMANIA                   |   1994 | 469977929.202231
 ROMANIA                   |   1993 | 470426401.007179
 ROMANIA                   |   1992 | 473717007.393695
 RUSSIA                    |   1998 | 268940412.349688
 RUSSIA                    |   1997 | 467874852.346122
 RUSSIA                    |   1996 | 476951124.243719
 RUSSIA                    |   1995 | 471119824.794661
 RUSSIA                    |   1994 | 466683060.503705
 RUSSIA                    |   1993 | 472500429.340992
 RUSSIA                    |   1992 | 465198162.143157
 SAUDI ARABIA              |   1998 | 272455634.492026
 SAUDI ARABIA              |   1997 | 474250914.172268
 SAUDI ARABIA              |   1996 | 472951666.358526
 SAUDI ARABIA              |   1995 |  468320614.76523
 SAUDI ARABIA              |   1994 | 468474260.676784
 SAUDI ARABIA              |   1993 | 467597684.920828
 SAUDI ARABIA              |   1992 | 469012530.190148
 UNITED KINGDOM            |   1998 |  263397026.94284
 UNITED KINGDOM            |   1997 |  468002979.01831
 UNITED KINGDOM            |   1996 | 473064722.413993
 UNITED KINGDOM            |   1995 | 463394335.225709
 UNITED KINGDOM            |   1994 | 463373581.834026
 UNITED KINGDOM            |   1993 | 463591652.106159
 UNITED KINGDOM            |   1992 | 468553601.372422
 UNITED STATES             |   1998 | 280904740.287501
 UNITED STATES             |   1997 | 478965054.411765
 UNITED STATES             |   1996 | 469612177.022578
 UNITED STATES             |   1995 | 471628197.268352
 UNITED STATES             |   1994 | 467607803.683822
 UNITED STATES             |   1993 | 472619182.613465
 UNITED STATES             |   1992 |  470958883.54246
 VIETNAM                   |   1998 | 276785019.072958
 VIETNAM                   |   1997 |  467105958.41126
 VIETNAM                   |   1996 | 474546023.842789
 VIETNAM                   |   1995 | 469186913.744545
 VIETNAM                   |   1994 | 468956577.077746
 VIETNAM                   |   1993 | 466819579.706015
 VIETNAM                   |   1992 | 461835827.449078
(175 rows)

COMMIT;
COMMIT
